var weavyFilebrowser=weavyFilebrowser||{};weavyFilebrowser.filebrowser=function(){var n=null,t=function(){return n};return window.addEventListener("message",function(t){t.data.name==="open"?(n=t.data.guid,$("button."+t.data.provider).trigger("click")):t.data.name==="create"&&weavyFilebrowser.google.create(t.data.title,t.data.type,t.data.guid)}),{contentType:t}}();weavyFilebrowser=weavyFilebrowser||{};weavyFilebrowser.google=function(){function v(){i?(n=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token,p()):(t="pick",gapi.auth2.getAuthInstance().signIn())}function it(){gapi.auth2.getAuthInstance().signIn()}function rt(){gapi.auth2.getAuthInstance().signOut()}function y(n){if(n){if(r.style.display="none",u.style.display="inline-block",i=!0,t!=null){switch(t){case"create":l(o,s,h);break;case"pick":v()}t=null}}else r.style.display="inline-block",u.style.display="none",i=!1}function ut(){e=!0;p()}function p(){var t,i;e&&n&&(t=new google.picker.DocsView,t.setParent("root"),t.setIncludeFolders(!0),i=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).addView(t).setOrigin(c).setOAuthToken(n).setDeveloperKey(f).setCallback(ft).build(),i.setVisible(!0))}function ft(t){var f="nothing",e,u,i;if(t[google.picker.Response.ACTION]==google.picker.Action.CANCEL&&weavyFilebrowser.helpers.close(),t[google.picker.Response.ACTION]==google.picker.Action.PICKED){for(e=[],u=0;u<t[google.picker.Response.DOCUMENTS].length;u++){i=t[google.picker.Response.DOCUMENTS][u];f=i[google.picker.Document.URL];var s=i[google.picker.Document.NAME],h=i[google.picker.Document.TYPE],c=i[google.picker.Document.MIME_TYPE],o=i[google.picker.Document.ID],r="";switch(c){case"application/vnd.google-apps.document":r="document";break;case"application/vnd.google-apps.spreadsheet":r="spreadsheet";break;case"application/vnd.google-apps.presentation":r="presentation";break;default:r=h==="photo"?"image":"file";f="https://drive.google.com/uc?id="+o}e.push({url:f,title:s,type:r,guid:weavyFilebrowser.filebrowser.contentType()});a(o,n)}weavyFilebrowser.helpers.add(e,"google-drive")}}var f="AIzaSyDV97LeMmjAMyVQAOUqZH5bU4GFk3-Qwn4",w="284489188582-c221gv8ubafv46c0bokohu3cri4589tv.apps.googleusercontent.com",b=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],e=!1,n,i=!1,t=null,o="",s="",h="",c="",k="https://www.googleapis.com/auth/drive",r=$("button.create-auth")[0],d=$("button.google-drive")[0],u=document.getElementById("signout-button"),g=function(){gapi.client.init({apiKey:f,clientId:w,discoveryDocs:b,scope:k}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.listen(y);y(gapi.auth2.getAuthInstance().isSignedIn.get());r.onclick=it;d.onclick=v;u.onclick=rt})},nt=function(n,r,u){i?l(n,r,u):(o=n,s=r,h=u,t="create",gapi.auth2.getAuthInstance().signIn())},l=function(t,i,r){var u={name:t,mimeType:"application/vnd.google-apps."+i};gapi.client.drive.files.create({resource:u,fields:"*"}).then(function(u){switch(u.status){case 200:var f=u.result,e=f.id;weavyFilebrowser.helpers.add([{url:f.webViewLink,title:t,type:i,guid:r}],"google-drive",!0);n=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;a(e,n);break;default:console.log("Error creating the file, "+u)}})},tt=function(n){c=n;gapi.load("client:auth2",g);gapi.load("picker",ut)},a=function(n,t){var i={role:"reader",type:"anyone"},r=gapi.auth2.getAuthInstance().currentUser.get().getHostedDomain(),u;r&&(i={role:"writer",type:"domain",domain:r});u=gapi.client.request({path:"/drive/v3/files/"+n+"/permissions",method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t},body:i});u.execute(function(){})};return{onLoad:tt,create:nt}}();weavyFilebrowser=weavyFilebrowser||{};weavyFilebrowser.dropbox=function(){$(function(){$("button.dropbox").on("click",function(){var n={multiselect:!0,success:function(n){for(var i=[],t=0;t<n.length;t++)i.push({url:n[t].link,title:n[t].name,guid:weavyFilebrowser.filebrowser.contentType()});weavyFilebrowser.helpers.add(i,"dropbox")}};Dropbox.choose(n)})})}();weavyFilebrowser=weavyFilebrowser||{};weavyFilebrowser.box=function(){var n=new BoxSelect({clientId:"7d8r9id64e17x70f094qjkfem58rlanc",linkType:"shared"});n.success(function(n){for(var i=[],t=0;t<n.length;t++)i.push({url:n[t].url,title:n[t].name,guid:weavyFilebrowser.filebrowser.contentType()});weavyFilebrowser.helpers.add(i,"box")});n.cancel(function(){console.log("The user clicked cancel or closed the popup")});$(function(){$("button.box").on("click",function(){n.launchPopup()})})}();weavyFilebrowser=weavyFilebrowser||{};weavyFilebrowser.onedrive=function(){$(function(){$("button.onedrive").on("click",function(){var n={clientId:"45ae3579-45ca-42ee-94b0-14a5518865a6",action:"share",multiSelect:!0,success:function(n){for(var i=[],t=0;t<n.value.length;t++)i.push({url:n.value[t].permissions[0].link.webUrl,title:n.value[t].name,guid:weavyFilebrowser.filebrowser.contentType()});weavyFilebrowser.helpers.add(i,"onedrive")}};OneDrive.open(n)})})}();weavyFilebrowser=weavyFilebrowser||{};weavyFilebrowser.helpers=function(){var n=function(n,t,i){window.parent.postMessage({name:"insert",links:n,provider:t,open:i||!1},"*")},t=function(){window.parent.postMessage({name:"closePicker"},"*")};return window.self!==window.top&&$(".button-container").css("display","none"),{add:n,close:t}}();