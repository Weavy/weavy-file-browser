var weavyFilebrowser=weavyFilebrowser||{};weavyFilebrowser.helpers=function(){function e(e){var o=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(o);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}window.self!==window.top&&$(".button-container").css("display","none");var o;return{add:function(e,o,n){window.parent.postMessage({name:"insert",links:e,provider:o,open:n||!1},"*")},close:function(){window.parent.postMessage({name:"closePicker"},"*")},post:function(e){window.parent.postMessage({name:e},"*")},getParameter:e,origin:e("origin"),version:e("v")||"legacy",isMultiple:(o=e("multiple"))?"1"==o||"TRUE"===o.toUpperCase():null==e("v")}}(),(weavyFilebrowser=weavyFilebrowser||{}).filebrowser=function(){var o=null;return window.addEventListener("message",function(e){"open"===e.data.name?(o=e.data.guid,$("button."+e.data.provider).trigger("click")):"create"===e.data.name&&weavyFilebrowser.google.create(e.data.title,e.data.type,e.data.guid)}),{contentType:function(){return o}}}(),(weavyFilebrowser=weavyFilebrowser||{}).google=function(){function o(e){gapi.client.init({apiKey:n,clientId:"284489188582-c221gv8ubafv46c0bokohu3cri4589tv.apps.googleusercontent.com",discoveryDocs:t,scope:"https://www.googleapis.com/auth/drive"}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.listen(k),k(gapi.auth2.getAuthInstance().isSignedIn.get()),g.onclick=y,d.onclick=b,w.onclick=f,weavyFilebrowser.helpers.post("google-init-complete")})}var p,n="AIzaSyDV97LeMmjAMyVQAOUqZH5bU4GFk3-Qwn4",t=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],i=!1,r=!1,a=null,l="",s="",c="",u="",g=$("button.create-auth")[0],d=$("button.google-drive")[0],w=document.getElementById("signout-button"),v=function(t,i,r){var e={name:t,mimeType:"application/vnd.google-apps."+i};gapi.client.drive.files.create({resource:e,fields:"*"}).then(function(e){var o,n;200===e.status?(n=(o=e.result).id,weavyFilebrowser.helpers.add([{url:o.webViewLink,title:t,type:i,guid:r}],"google-drive",!0),p=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token,h(n,p)):console.log("Error creating file: "+e)})},h=function(e,o){var n={role:"reader",type:"anyone"},t=gapi.auth2.getAuthInstance().currentUser.get().getHostedDomain();t&&(n={role:"writer",type:"domain",domain:t}),gapi.client.request({path:"/drive/v3/files/"+e+"/permissions",method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o},body:n}).execute(function(e){})};function b(){r?(p=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token,e()):(a="pick",gapi.auth2.getAuthInstance().signIn())}function y(e){gapi.auth2.getAuthInstance().signIn()}function f(e){gapi.auth2.getAuthInstance().signOut()}function k(e){if(e){if(g.style.display="none",w.style.display="inline-block",r=!0,null!=a){switch(a){case"create":v(l,s,c);break;case"pick":b()}a=null}}else g.style.display="inline-block",w.style.display="none",r=!1}function m(){i=!0,e()}function e(){var e,o;i&&p&&((e=new google.picker.DocsView).setParent("root"),e.setIncludeFolders(!0),o=(new google.picker.PickerBuilder).addView(e).setOrigin(u).setOAuthToken(p).setDeveloperKey(n).setCallback(F),weavyFilebrowser.helpers.isMultiple&&(o=o.enableFeature(google.picker.Feature.MULTISELECT_ENABLED)),o=o.build().setVisible(!0))}function F(e){var o="nothing";if(e[google.picker.Response.ACTION]==google.picker.Action.CANCEL&&weavyFilebrowser.helpers.close(),e[google.picker.Response.ACTION]==google.picker.Action.PICKED){for(var n=[],t=0;t<e[google.picker.Response.DOCUMENTS].length;t++){var i=e[google.picker.Response.DOCUMENTS][t],o=i[google.picker.Document.URL],r=i[google.picker.Document.NAME],a=i[google.picker.Document.TYPE],l=i[google.picker.Document.MIME_TYPE],s=i[google.picker.Document.ID],c="";switch(l){case"application/vnd.google-apps.document":c="document";break;case"application/vnd.google-apps.spreadsheet":c="spreadsheet";break;case"application/vnd.google-apps.presentation":c="presentation";break;default:c="photo"===a?"image":"file",o="https://drive.google.com/uc?id="+s}n.push({url:o,title:r,type:c,guid:weavyFilebrowser.filebrowser.contentType()}),h(s,p)}weavyFilebrowser.helpers.add(n,"google-drive")}}return{onLoad:function(e){u=e,gapi.load("client:auth2",o),gapi.load("picker",m)},create:function(e,o,n){r?v(e,o,n):(l=e,s=o,c=n,a="create",gapi.auth2.getAuthInstance().signIn().catch(function(e){weavyFilebrowser.helpers.post("google-cancelled")}))}}}(),(weavyFilebrowser=weavyFilebrowser||{}).dropbox=void $(function(){$("button.dropbox").on("click",function(){var e={multiselect:weavyFilebrowser.helpers.isMultiple,success:function(e){for(var o=[],n=0;n<e.length;n++)o.push({url:e[n].link,title:e[n].name,guid:weavyFilebrowser.filebrowser.contentType()});weavyFilebrowser.helpers.add(o,"dropbox")}};Dropbox.choose(e)})}),(weavyFilebrowser=weavyFilebrowser||{}).box=function(){var e={clientId:"7d8r9id64e17x70f094qjkfem58rlanc",linkType:"shared",multiselect:weavyFilebrowser.helpers.isMultiple},o=new BoxSelect(e);o.success(function(e){for(var o=[],n=0;n<e.length;n++)o.push({url:e[n].url,title:e[n].name,guid:weavyFilebrowser.filebrowser.contentType()});weavyFilebrowser.helpers.add(o,"box")}),o.cancel(function(){console.log("The user clicked cancel or closed the popup")}),$(function(){$("button.box").on("click",function(){o.launchPopup()})})}(),(weavyFilebrowser=weavyFilebrowser||{}).onedrive=void $(function(){$("button.onedrive").on("click",function(){var e={clientId:"45ae3579-45ca-42ee-94b0-14a5518865a6",action:"share",multiSelect:weavyFilebrowser.helpers.isMultiple,success:function(e){for(var o=[],n=0;n<e.value.length;n++)o.push({url:e.value[n].permissions[0].link.webUrl,title:e.value[n].name,guid:weavyFilebrowser.filebrowser.contentType()});weavyFilebrowser.helpers.add(o,"onedrive")}};OneDrive.open(e)})});